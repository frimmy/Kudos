

{% set post_object = post.get('post_object') %}
<!-- user post_object.author to get user info on that post -->

<div class="post" id="{{post_object.id}}">
  <div class="taggees">
    <div class="avatars">
      <!-- will always display user tags before team tags -->
    {% set g_user_tagged_in_post = [] %}
    {% if post.get('tagged_users') %}
      {% for tag in post.get('tagged_users') %}
        <!-- check if current_user is tagged in post -->
        {% if tag.user_tag.username == g.user.username %}
          {% do g_user_tagged_in_post.append(1) %}
        {% endif %}
        <div class="avatar-container" id="{{tag.id}}">
          <a class="avatar" id="{{tag.id}}" href="{{ url_for('user', username=tag.user_tag.username) }}">
          	<div class="cropper">
                <img src="{{tag.user_tag.photo}}" alt="{{tag.username}}" />
        	  </div>
          </a>

          <div class="remove-tag">
            <a href="#">
              remove 
            </a>

          </div>
        </div>
      {% endfor %}
    {% endif %}
    {% if post.get('tagged_teams') %}
      {% for tag in post.get('tagged_teams') %}
        <div class="avatar-container" id="{{tag.id}}">
          <a class="avatar" id="{{tag.id}}" href="{{ url_for('team', team=tag.team_tag.teamname) }}">
            <div class="cropper">
                <img src="{{tag.team_tag.photo}}" alt="{{tag.team_tag.teamname}}" />
            </div>
          </a>
          <div class="remove-tag">
              <a href="#">
                remove
              </a>
          </div>
        </div>
      {% endfor %}
    {% endif %}
    </div>
  </div>


  <div class="white-card">
    <blockquote>
      {{post_object.body}}
    </blockquote>

    <div class="post-author">
      <a href="{{ url_for('user', username=post_object.author.username) }}" class="author-name">
        {{post_object.author.firstname}} {{post_object.author.lastname}}
      </a>,  
      <a href="{{ url_for('team', team='Hackbright')}}" class="team-name">
        Hackbright
      </a> 
    </div>
    <div class="post-metadata">
      {% set comments = post.get('children_objects')|length %}
      {% if comments == 1 %}
        <a href="#" class="comment-count">{{comments}} Comment</a>
      {% else %}
        <a href="#" class="comment-count">{{comments}} Comments</a>
      {% endif %}
          
      <br> 
      
      <!-- show # thanks received if you're tagged in post or you're author -->
      {% if g_user_tagged_in_post or g.user.username == post_object.author.username%}
        {% if post.get('thanks_senders')|length != 0 %}
          <a href="#">{{post.get('thanks_senders')|length}} Thanks</a>
        {% elif post.get('thanks_senders')|length == 1 %}
          <a href="#">{{post.get('thanks_senders')|length}} Thank</a>
        {% else %}
          <a href="#">No Thanks</a>
        {% endif %}
      {% else %}
        <!-- you're not tagged in this -->
      {% endif %}
    </div>
  </div>

  <div class="toolbar">
    <a class="toolbar-button addtag-button" id="addtag-button" href="#">
      Add Tag
    </a>
    <a class="toolbar-button comment-button" id="addcomment-button" href="#">
      Comment
    </a>
    <a class="toolbar-button thank-button" href="#" name="send-thanks" id="{{post_object.id}}">
      Thank
    </a>
    
    {% if g.user.username == post_object.author.username %}
      <a class="toolbar-button removepost-button" href="{{ url_for('delete_post', postid=post_object.id) }}">
        Remove Kudos
      </a>

    {% endif %}
  </div>

<!-- new tag -->
  <div class="tag-modal clearfix" id="{{post_object.id}}" style="display: none;">
    <form action="/newtag" method="POST" class="new-tag-form" id="{{post_object.id}}">  
      <div class="tags">
        <input type="text" class="tag-input" value placeholder="tags"/>
      </div>
     
      <button type="submit" class="new-tag-btn" id="{{post_object.id}}" value="submit"> 
        Submit 
      </button>
      {{ reply_form.hidden_post_id(value=post_object.id) }}
      {{ new_post_form.hidden_tag_ids (class="hidden_tag_ids", id=post_object.id) }}
      {{ new_post_form.hidden_tag_text (class="hidden_tag_text", id=post_object.id) }}
    </form>
  </div>


<!-- new comment -->
  <div class="comment-modal" id="{{post_object.id}}" style="display: none;">
    <form action="/newcomment" method="POST">
      {{new_post_form.csrf_token}}

        <div class="comment_body" id="{{post_object.id}}">
          {{reply_form.reply_body (class="reply-body", id="{{post_object.id}}")}}

          
          <button type="submit" class="new-comment-btn" name="new_reply_btn" id="{{post_object.id}}" value="submit"> reply </button>
          
        </div>

      <!-- Associate text box with specific post -->
      <!-- with ajax can just get id of comment_body. not needed ->{{ reply_form.hidden_post_id(value=post_object.id) }} -->
    </form>
  </div>
</div>

<!-- Display comments on post -->
<div class="comments" id="{{post_object.id}}">

  {% for post_comment in post.get('children_objects') %}
    <div class="one-comment" id="{{post_comment.id}}">
      <div class="clearfix">

        <a class="avatar" href="{{ url_for('user', username=post_comment.author.username) }}">
          <div class="cropper">
              <img src="{{post_comment.author.photo}}" alt="{{post_comment.author.username}}" />
          </div>
        </a>
          <span class="comment-body">
          {{post_comment.body}}
        </span>

        <a href="{{ url_for('user', username=post_comment.author.username) }}" class="comment-author">{{post_comment.author.firstname}} {{post_comment.author.lastname}}</a>
        {% if post_comment.author.username == g.user.username %}
          <div class="remove-comment" id="{{post_comment.id}}">
            <a href="#">
              Remove
            </a>
          </div>
        {% endif %}
      </div>
    </div>
  {% endfor %}
</div>
